/**
 * Name         : Joystick.js
 * @author      : Mirielle S. (codeBreaker!)
 * Last Modified: 24.06.2020
 * Revision     : 0.0.1
 * 
 * MIT License
 * 
 * Copyright (c) 2020 CodeBreaker
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */

CanvasRenderingContext2D.prototype.__proto__={Joystick2dArc(t,i,s,h,e,a=0){this.save(),this.lineWidth=a,this.strokeStyle=e||h,this.fillStyle=h,this.beginPath(),this.arc(t,i,s,0,2*Math.PI),this.closePath(),"none"!==e&&""!==e&&this.stroke(),void 0!==h&&"none"!==h&&""!==h&&this.fill(),this.restore()}};class Joystick2D{constructor(t){this.canvas=t.canvas;try{this.ctx=this.canvas.getContext("2d")}catch(t){throw"Joystick2D Failed to intialize CANVAS"}this.x=t.x||this.canvas.width/2,this.y=t.y||this.canvas.height/2,this.origin={x:t.x||this.x,y:t.y||this.y},this.radius=t.size||50,this.obj=t.component,this.speed=t.speed||{value:1,max:2,type:"dynamic"},this.color=t.color||"lightgray",this.lineWidth=t.lineWidth||4,this.outlineColor=t.outlineColor||"#222",this.backgroundColor=t.backgroundColor||"none",this.backgroundOutlineColor=t.backgroundOutlineColor||"#222",this.backgroundLineWidth=t.backgroundLineWidth||4,this.radius1=15,this.angle=0,this.isActive=!1,this.timeSpan=10,this.timeSpanCounter=this.timeSpan,this.speedCounter=0,this.isDisplay=!1,this.isFading=!1,this.alpha=1,this.__diffX=null,this.__diffY=null}draw(){this.ctx.save(),this.ctx.globalAlpha=this.alpha,this.ctx.Joystick2dArc(this.origin.x,this.origin.y,this.radius,this.backgroundColor,this.backgroundOutlineColor,this.backgroundLineWidth),this.ctx.Joystick2dArc(this.x,this.y,this.radius1,this.color,this.outlineColor,this.lineWidth),this.ctx.restore()}accelerate(){let t=Math.hypot(this.__diffX,this.__diffY)/(10*this.speed.max+this.speed.value);return t>=this.speed.max&&(t=this.speed.max),t}moveObj(){if(this.isActive)if(this.obj.x&&this.obj.y&&"number"==typeof this.obj.x&&"number"==typeof this.obj.y){let t=this.accelerate();this.obj.x+=Math.cos(this.angle)*t,this.obj.y+=Math.sin(this.angle)*t}else console.error("Binded component Must be a 2D Vector with a {[X, Y]:number} value")}fadeIn(){this.isFading&&(this.timeSpanCounter-=1,this.alpha=Math.abs(this.timeSpanCounter/this.timeSpan),this.alpha<=0&&(this.isDisplay=!1,this.timeSpanCounter=this.timeSpan))}update(){this.isDisplay&&this.draw(),this.moveObj(),this.fadeIn()}activate(){"touchstart"in document.documentElement&&(this.ctx.canvas.addEventListener("touchstart",t=>{this.origin.x=t.touches[0].pageX,this.origin.y=t.touches[0].pageY,this.x=t.touches[0].pageX,this.y=t.touches[0].pageY,this.isActive=!0,this.isDisplay=!0,this.isFading=!1,this.alpha=1}),this.ctx.canvas.addEventListener("touchmove",t=>{let i=t.touches[0].pageX-this.origin.x,s=t.touches[0].pageY-this.origin.y,h=Math.hypot(i,s);this.angle=Math.atan2(s,i),this.isActive=!0,this.__diffX=i,this.__diffY=s;let e=Math.min(h,this.radius);this.x=this.origin.x+Math.cos(this.angle)*e,this.y=this.origin.y+Math.sin(this.angle)*e}),this.ctx.canvas.addEventListener("touchend",t=>{this.isActive=!1,this.x=this.origin.x,this.y=this.origin.y,"dynamic"===this.speed.type.toLowerCase()&&(this.speed.value=0),this.isFading=!0}))}}
